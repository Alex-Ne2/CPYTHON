
import sys

HEADER = "/* This file generated by Tools/core_objects/gen_header.py */"

def print_struct(length):
    print(f"""
typedef struct _ascii_{length} {{
    PyASCIIObject object;
    char text[{length+1}];
}} _PyAsciiId_{length};
""")

def main(idsfile="identifiers.txt"):
    print(HEADER)
    print('#ifndef _PY_CORE_OBJECTS_H')
    print('#define _PY_CORE_OBJECTS_H')
    print()
    print('#include "Python.h"\n')
    with open(idsfile) as fd:
        identifiers = [line.strip() for line in fd if line.strip()]
    lens = { len(id) for id in identifiers }
    for length in lens:
        print_struct(length)
    print("typedef struct _py_id_strings {")
    for name in identifiers:
        print(f"    _PyAsciiId_{len(name)} id_{name};")
    print("} _PyIdStrings;")
    print()
    print("extern _PyIdStrings _Py_id_strings;")
    print("extern void _Py_intern_identifiers(void);")

    print('#endif // _PY_CORE_OBJECTS_H')

if __name__ == '__main__':
    main(sys.argv[1])
