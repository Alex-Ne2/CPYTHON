Refactor formatting methods from editor.py and add tests.
