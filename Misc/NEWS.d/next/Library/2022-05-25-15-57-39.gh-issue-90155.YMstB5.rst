Fix broken :class:`asyncio.Semaphore` and strengthen FIFO guarantee.
