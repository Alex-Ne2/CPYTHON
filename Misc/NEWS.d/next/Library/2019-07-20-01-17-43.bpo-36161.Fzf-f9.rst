Use ttyname_r instead of ttyname for thread safety
