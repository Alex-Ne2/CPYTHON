fix crash on array iterator when setting state when exhausted
