Simplify and optimize os.walk by using isinstance checks to check the top of the stack.
