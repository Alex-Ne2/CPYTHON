Improve build-in :func:`compile` in mode 'single'.  Patch by Weipeng Hong.
